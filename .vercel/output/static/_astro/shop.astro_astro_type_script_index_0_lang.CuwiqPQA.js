let n=[];const g=document.getElementById("cart-sidebar"),q=document.getElementById("cart-overlay"),h=document.getElementById("cart-items"),y=document.getElementById("cart-total"),s=document.getElementById("checkout-btn"),w=document.getElementById("close-cart"),C="junkerri-cart";function I(){try{const t=localStorage.getItem(C);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load cart from localStorage:",t),[]}}function m(t){try{localStorage.setItem(C,JSON.stringify(t))}catch(e){console.error("Failed to save cart to localStorage:",e)}}n=I();console.log("üõí Cart loaded from storage:",n);let u={};function E(){console.log("üõí Starting to update product data...");const t=document.querySelectorAll("[data-product-id]");console.log(`üõí Found ${t.length} product buttons`),t.forEach(e=>{const o=e.getAttribute("data-product-id"),r=e.getAttribute("data-price-id"),c=e.closest(".product-item");if(!c){console.warn("No product container found for button:",o);return}const a=c.querySelector("h3")?.textContent,i=c.querySelector(".text-primary")?.textContent,l=c.querySelector("img")?.getAttribute("src");if(console.log("üõí Processing product:",{productId:o,productName:a,productPrice:i,productImage:l,productPriceId:r}),o&&a&&i&&l&&r){const p=parseFloat(i.replace("$",""));u[o]={name:a,price:p,image:l,priceId:r},console.log(`‚úÖ Added product data for ${o}:`,u[o])}else console.warn("Missing data for product:",{productId:o,productName:a,productPrice:i,productImage:l,productPriceId:r})}),console.log("üõí Final product data for cart:",u),f(),L()}function L(){console.log("üîß Setting up cart event listeners..."),document.querySelectorAll("[data-product-id]").forEach(t=>{t.removeEventListener("click",x),t.addEventListener("click",x)}),console.log(`üîß Added event listeners to ${document.querySelectorAll("[data-product-id]").length} buttons`)}function x(t){const o=t.currentTarget.getAttribute("data-product-id");if(!o){console.warn("No product ID found on button");return}console.log("üõí Add to cart clicked for product:",o),console.log("üõí Available product data:",u);const r=u[o];if(!r){console.warn("Product data not found for:",o),d("Product data not available. Please refresh the page.","error");return}const c=n.find(a=>a.id===o);c?(c.quantity+=1,d(`Updated quantity for ${r.name}`,"success")):(n.push({id:o,priceId:r.priceId,name:r.name,price:r.price,image:r.image,quantity:1}),d(`Added ${r.name} to cart`,"success")),f(),m(n),$()}function f(){if(!h||!y||!s)return;h.innerHTML=n.map(e=>`
        <div class="flex w-full items-center gap-3 p-4 border border-border rounded-lg bg-background/50" data-cart-item-id="${e.id}">
          <img src="${e.image}" alt="${e.name}" class="w-14 h-14 object-cover rounded shrink-0" />
          <div class="flex-1 min-w-0">
            <h4 class="font-medium truncate">${e.name}</h4>
            <p class="text-sm text-muted-foreground">$${e.price}</p>
          </div>
          <div class="flex items-center gap-2 shrink-0">
            <button class="quantity-btn-decrease text-muted-foreground hover:text-foreground p-1 rounded" data-product-id="${e.id}" aria-label="Decrease quantity">-</button>
            <span class="w-8 text-center">${e.quantity}</span>
            <button class="quantity-btn-increase text-muted-foreground hover:text-foreground p-1 rounded" data-product-id="${e.id}" aria-label="Increase quantity">+</button>
          </div>
          <button class="remove-btn text-red-500 hover:text-red-700 p-1 shrink-0" data-product-id="${e.id}" aria-label="Remove item">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          </button>
        </div>
      `).join(""),P();const t=n.reduce((e,o)=>e+o.price*o.quantity,0);y.textContent=`$${t.toFixed(2)}`,T(t),s.disabled=n.length===0,v()}function T(t){const e=document.getElementById("standard-shipping-text");e&&(t>=75?(e.textContent="Standard Shipping: FREE (3-7 business days)",e.className="text-green-600 font-medium"):(e.textContent=`Standard Shipping: $5.00 (3-7 business days) - Add $${(75-t).toFixed(2)} more for free shipping!`,e.className="text-muted-foreground"))}function P(){document.querySelectorAll(".quantity-btn-decrease").forEach(t=>{t.addEventListener("click",e=>{const o=e.currentTarget.getAttribute("data-product-id");o&&k(o,-1)})}),document.querySelectorAll(".quantity-btn-increase").forEach(t=>{t.addEventListener("click",e=>{const o=e.currentTarget.getAttribute("data-product-id");o&&k(o,1)})}),document.querySelectorAll(".remove-btn").forEach(t=>{t.addEventListener("click",e=>{const o=e.currentTarget.getAttribute("data-product-id");o&&B(o)})})}function k(t,e){const o=n.find(r=>r.id===t);o&&(o.quantity+=e,o.quantity<=0&&(n=n.filter(r=>r.id!==t)),f(),m(n))}function B(t){n=n.filter(e=>e.id!==t),f(),m(n),d("Item removed from cart","info")}function $(){g&&g.classList.remove("translate-x-full")}function A(){g&&g.classList.add("translate-x-full")}function v(){const t=document.querySelector(".cart-badge");if(t){const e=n.reduce((o,r)=>o+r.quantity,0);t.textContent=e.toString(),t.classList.toggle("hidden",e===0)}}w&&w.addEventListener("click",A);window.addEventListener("openCart",()=>{console.log("üõí Header cart button clicked, opening cart..."),$()});console.log("üõí Cart script loaded");console.log("üõí Initial cart state:",n);console.log("üõí Cart elements found:",{cartSidebar:!!g,cartOverlay:!!q,cartItems:!!h,cartTotal:!!y,checkoutBtn:!!s});s&&s.addEventListener("click",async()=>{if(n.length!==0)try{s.disabled=!0,s.innerHTML=`
            <svg class="animate-spin -ml-1 mr-3 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Creating Checkout...
          `;const t=n.map(a=>({price:a.priceId,quantity:a.quantity}));console.log("üõí Creating checkout session for:",t);const e=window.location.href;console.log("üåê Current page URL for redirect:",e);const o=n.reduce((a,i)=>a+i.price*i.quantity,0);console.log("üí∞ Order total for shipping:",o);const r=await fetch("/api/stripe/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t,currentPageUrl:e,orderTotal:o})});if(console.log("üõí Checkout response status:",r.status),console.log("üõí Checkout response headers:",r.headers),!r.ok){const a=await r.text();throw console.error("‚ùå Checkout API error response:",a),new Error(`HTTP error! status: ${r.status}, response: ${a}`)}const c=await r.json();if(c.success&&c.url)console.log("‚úÖ Redirecting to Stripe checkout..."),d("Redirecting to checkout...","success"),A(),window.location.href=c.url;else throw new Error(c.error||"Checkout failed")}catch(t){console.error("‚ùå Checkout error:",t),d(`Checkout failed: ${t instanceof Error?t.message:"Unknown error"}`,"error")}finally{s.disabled=!1,s.innerHTML="Proceed to Checkout"}});function d(t,e="info"){const o=document.querySelector(".notification");o&&o.remove();const r=document.createElement("div");r.className=`notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 ${e==="success"?"bg-green-500 text-white":e==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,r.innerHTML=`
        <div class="flex items-center gap-2">
          <span>${t}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-white hover:text-gray-200">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      `,document.body.appendChild(r),setTimeout(()=>{r.parentElement&&r.remove()},5e3)}const S=document.querySelectorAll("[data-category]"),F=document.querySelectorAll(".product-item");S.forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-category");e&&(S.forEach(o=>o.classList.remove("bg-primary","text-primary-foreground")),t.classList.add("bg-primary","text-primary-foreground"),F.forEach(o=>{e==="All"||o.getAttribute("data-category")===e?o.style.display="block":o.style.display="none"}))})});setTimeout(()=>{E(),v(),M(),N()},100);function M(){const t=new URLSearchParams(window.location.search),e=t.get("success"),o=t.get("canceled");e==="true"?(d("Payment successful! Thank you for your purchase.","success"),n=[],m(n),f(),window.history.replaceState({},document.title,window.location.pathname)):o==="true"&&(d("Payment was canceled. Your cart items are still available.","info"),window.history.replaceState({},document.title,window.location.pathname))}function b(){const t=document.querySelector(".grid");if(!t){console.log("üõçÔ∏è Product grid not found, waiting..."),setTimeout(b,100);return}const e=t.querySelectorAll(".product-item");e.length>0?(console.log(`üõçÔ∏è Found ${e.length} products, setting up cart...`),E(),v()):(console.log("üõçÔ∏è Products not yet rendered, waiting..."),setTimeout(b,200))}function N(){const t=document.querySelectorAll(".size-btn");t.forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const r=o.currentTarget,c=r.getAttribute("data-target-product"),a=r.getAttribute("data-size"),i=r.getAttribute("data-price");if(!c||!a||!i)return;console.log(`üéØ Size button clicked: ${a} for product ${c} at price $${i}`),t.forEach(p=>{p.getAttribute("data-target-product")===c&&(p.classList.remove("bg-primary","text-white","border-primary"),p.classList.add("border-input","bg-background","text-white"))}),r.classList.remove("border-input","bg-background","text-foreground"),r.classList.add("bg-primary","text-white","border-primary");const l=document.querySelector(`[data-product-id="${c}"] .text-primary`);l?(l.textContent=`$${i}`,console.log(`üí∞ Updated price for ${c} to $${i}`)):console.log(`‚ùå Could not find price element for ${c}`),u[c]&&(u[c].price=parseFloat(i))})})}b();
